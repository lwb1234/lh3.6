var MAIN_DOMAIN = "/",
CG = CG || {};
var SLIDE = function(h, a, j, b, i, g, c, d, f) {
	var e = this;
	if (!h) {
		return false;
	}
	this.name = c;
	this.now = 1;
	this.lock = 0;
	this.stage = h;
	this.nav = a;
	this.stageId = j;
	this.navId = b;
	this.height = i;
	this.count = g;
	if (!g) {
		return;
	}
	this.hoverDom = f;
	this.hoverDom.mouseover(function() {
		e.lock = 1;
	}).onmouseout(function() {
		e.lock = 0;
	});
	this.li = this.nav.find("a");
	this.li.mouseover(function() {
		var k = e.li.index(this);
		e.scrol(k + 1);
		e.lock = 1;
	});
	setInterval(function() {
		if (!e.lock) {
			e.scrol();
		}
	},
	d);
};
SLIDE.prototype.scrol = function(e) {
	var c = this;
	e = e || (c.now) % c.count + 1;
	if (e == c.now) {
		return;
	}
	var a = $("#JS_slide_img_" + e);
	var d = a.attr("data-src2");
	if (d) {
		a.attr("src") = d;
	}
	if (this.nav) {
		var b = $("#" + c.navId + e);
		this.li.removeClass("current");
		b.addClass("current");
	}
	this.stage.stop(true).animate({
		marginTop: ((1 - e) * c.height) + "px"
	});
	c.now = e;
};
window.myfocus = new SLIDE($("#JS_slide_stage"), $("#JS_slide_nav"), "JS_slide_stage_", "JS_slide_nav_", 249, $("#JS_slide_nav a").length, "myfocus", 5000, $("#JS_slide_nav a"));
var _currentRankId = 0;
function setRankCurrent(j) {
	if (!j) {
		j = 0;
	}
	if (j == _currentRankId) {
		return;
	}
	var h = $("#JS_left_rank_" + j);
	var i = $("#JS_left_rank_" + _currentRankId);
	if (h && i) {
		var c = h.find("span").eq(1);
		var g = i.find("span").eq(1);
		if (c && g) {
			var b = c.find("a").eq(0);
			var e = g.find("a").eq(0);
			if (b && e) {
				
			}
		}
		h.addClass("current");
		i.removeClass("current");
		_currentRankId = j;
	}
}
function toggleCatgory1(c) {
	var g = $("#JS_category_body_" + c);
	var j = $("#JS_category_icon2_" + c);
	var h = $("#JS_category_title_" + c);
	var d = $("#JS_category_body_" + _currentCat);
	var i = $("#JS_category_icon2_" + _currentCat);
	var e = $("#JS_category_title_" + _currentCat);
	if (g && j) {
		if (_currentCat == c) {
			i.html("+");
			d.addClass("none");
			_currentCat = -1;
		} else {
			var f = g.find("b");
			var k = g.find("dd");
			g.removeClass("none");
			j.html("-");
			if (_currentCat != "-1" && d && i) {
				d.addClass("none");
				i.html("+");
			}
			_currentCat = c;
		}
	}
}
function toggleCatgory2(e) {
	e = $(e);
	if (e.length) {
		var a = e;
		var c = e.parent().parent().find("dd").eq(0);
		if (a.prop("nodeName") != "B") {
			a = e.find("b").eq(0);
			c = e.parent().find("dd").eq(0);
		}
	}
	if (a.length) {
		if (a.hasClass("current")) {
			a.html("+");
			a.removeClass("current");
			c.addClass("none");
			return false;
		} else {
			a.html("&minus;");
			a.addClass("current");
			c.removeClass("none");
		}
	}
}
function goodAddToCat(c, b) {
	c = c || null;
	if (c == null) {
		return;
	}
	_gaq.push(["_trackEvent", "categoryEvent", "addToCart", b]);
	var a = {};
	a[c] = "1";
	$.addToCart(c, a, null, {
		is_logistics: "1"
	});
}
function goodCollect(a) {
	a = a || null;
	if (a == null) {
		return;
	}
	$.ajax({
		url: "/ajax_user/?act=collect&id=" + a,
		dataType: "json",
		cache: false,
		success: function(b) {
			if (b.error == 2) {
				$.cookie("meilele_login", "0");
				$.showLoginBox(function() {
					goodCollect(a);
				});
			} else {
				$.alert(b.message);
			}
		},
		error: function() {
			$.alert("由于网络原因，收藏失败，请稍后再试。");
		}
	});
}
function CategoryInit() {
	CategoryInit2();
	var j = $("#JS_stock_pro_select");
	var f = $("#JS_stock_pro_selectbox");
	var k = $("#JS_stock_city_select");
	var i = $("#JS_stock_city_selectbox");
	var a = false;
	if (j && f && k && i) {
		var g = function() {
			j.addClass("current");
			f.removeClass("none");
		};
		var d = function() {
			j.removeClass("current");
			f.addClass("none");
		};
		var l = $(f).find("a");
		var b = $("#JS_selected_city_name");
		if (l && b) {
			l.click(function() {
				var o = $(this);
				var n = o.data("region");
				if (n == 0) {
					location.href = e(n);
				} else {
					if (n == 2) {
						location.href = e(35);
					} else {
						if (n == 10) {
							location.href = e(110);
						} else {
							if (n == 3) {
								location.href = e(36);
							} else {
								if (n == 23) {
									location.href = e(271);
								}
							}
						}
					}
				}
				var m = o.text();
				$("#JS_selected_pro_name").html(m);
				b.html("载入中...");
				d();
				$.ajax({
					url: MAIN_DOMAIN + 'ajax_ajax/?act=data_center&module=common&method=getRegionByParentId&param={"parent_id":' + n + "}",
					dataType: "json",
					success: function(q) {
						if (q && q.error == 0 && q.region_list) {
							b.html("请选择城市");
							var r = "";
							for (var p in q.region_list) {
								r += '<a href="' + e(q.region_list[p].region_id) + '">' + q.region_list[p].region_name + "</a>";
							}
							i.html(r);
							k.removeClass("none");
							a = true;
							k.addClass("current");
							i.removeClass("none");
							$("#JS_new_pro_select").show();
						}
					}
				});
			});
		}
		var h = function() {
			if (a) {
				k.addClass("current");
				i.removeClass("none");
			} else {
				var m = b.data("province");
				if (!m) {
					return;
				}
				d();
				$.ajax({
					url: MAIN_DOMAIN + 'ajax_ajax/?act=data_center&module=common&method=getRegionByParentId&param={"parent_id":' + m + "}",
					dataType: "json",
					success: function(o) {
						if (o && o.error == 0 && o.region_list) {
							var p = "";
							for (var n in o.region_list) {
								p += '<a href="' + e(o.region_list[n].region_id) + '">' + o.region_list[n].region_name + "</a>";
							}
							i.html(p);
							k.removeClass("none");
							a = true;
							k.addClass("current");
							i.removeClass("none");
						}
					}
				});
			}
		};
		var c = function() {
			k.removeClass("current");
			i.addClass("none");
		};
		j.click(function() {
			g();
			c();
		});
		k.click(function() {
			h();
			d();
		});
		function e(n) {
			var m = "javascript:;";
			if (_basic_url && n) {
				m = _basic_url.replace(/xxxx/, n);
			}
			return m;
		}
	}
	new TabMouseover("JS_fixture_recom", "fixture_commune", 1, _fixture_url);
	new TabMouseover("JS_fixture_article", "fixture_knowledge", 0, _fixture_bbs);
	$.lazyImg.start("both", {
		attributeTag: window.isWideScreen ? ["data-wide-src", "data-src"] : "data-src"
	});
}
function TabMouseover(f, g, d, c) {
	var a = $("#" + f + " .fixture_title");
	var b = $("." + g);
	var e = $("#" + f + " a");
	a.mouseover(function() {
		var i = a.index(this);
		for (var h = 0; h < a.length; h++) {
			if (a[h].innerHTML.length > 3 && d == 1) {
				a[h].innerHTML = a[h].innerHTML.slice(2);
			}
			a[h].className = "fixture_title Left";
			b[h].className = g + " none";
		}
		if (d == 1) {
			a[i].innerHTML = "推荐" + a[i].innerHTML;
		}
		a[i].className = "fixture_title Left current";
		b[i].className = g;
		if (c) {
			e[0].href = c[i];
		}
	});
}
var SaleNum = SaleNum || {};
SaleNum.idString = "";
SaleNum.setting = {
	sale: {
		type: "sales_num_ids",
		preFixId: "JS_bought_number_"
	},
	price: {
		type: "show_price_ids",
		preFixId: "JS_show_price_"
	}
};
SaleNum.getData = function(b) {
	SaleNum.type = b || "sale";
	var c = SaleNum.idString,
	a = SaleNum.setting[b];
	if (!c || !a || !a.type) {
		return;
	}
	$.ajax({
		url: "/mem_ajax/?act=" + a.type + "&id=" + c,
		dataType: "json",
		success: function(d) {
			SaleNum.dataHandle(d, a.preFixId);
		}
	});
};
SaleNum.dataHandle = function(c, d) {
	if (c && c.error == 0 && c.result) {
		var e = c.result,
		a;
		for (var b = e.length - 1; b >= 0; b--) {
			a = e[b];
			var f = $("#" + d + a.goods_id);
			f.html(a.num || 0);
		}
	}
};
function CategoryInit2() {
	var a = $("#JS_fliterTable");
	if (a) {
		var b = a.find("tr");
		if (b.length) {
			b.eq(_fliterShowNum).nextAll().addBack().addClass("none");
			if (_fliterShowNum > _fliterShowCount) {
				_fliterShowNum = _fliterShowCount;
			}
			var c = $("#JS_exp_fliter");
			var d = $("#JS_exp_fliter_text");
			c.click(function() {
				var e = $(this);
				if (e.is(".nav_box_show")) {
					e.removeClass("nav_box_show");
					d.html(d.data("show-text") || "更多选项");
					b.eq(_fliterShowNum).nextAll().addBack().addClass("none");
				} else {
					e.addClass("nav_box_show");
					d.html(d.data("close-text") || "收起");
					b.removeClass("none");
				}
			});
		}
	}
}
var priceDom = $("#JS_filter_price_btn"),
priceMax = $("#JS_filter_price_max"),
priceMin = $("#JS_filter_price_min");
if (priceDom.length && priceMax.length && priceMin.length) {
	function priceDiy() {
		var a = parseInt(priceMax.val()),
		d = parseInt(priceMin.val()),
		b,
		c = CG.priceUrl;
		if (a > 0 && d > 0 && c) {
			if (a < d) {
				b = d;
				d = a;
				a = b;
			}
			c = c.replace("max0", "max" + a);
			c = c.replace("min0", "min" + d);
			window.location.href = c;
		}
		return false;
	}
	priceDom.click(priceDiy);
	priceMax.keyup(function(a) {
		if (a.keyCode == 13) {
			priceDiy();
		}
	});
	priceMin.keyup(function(a) {
		if (a.keyCode == 13) {
			priceDiy();
		}
	});
}
var recommonDataHandler = function(e) {
	var a = e.length;
	var d = 0;
	var c = "";
	var b;
	var g = $("#JS_recommend_box");
	var f = $("#JS_recommend_content");
	for (; d < a; d++) {
		b = e[d];
		if (!b.goods_name) {
			continue;
		}
		c += '<div class="list clearfix';
		if (d == a - 1) {
			c += " last";
		}
		c += '"><div class="Left"><a href="';
		c += b.url;
		c += '" title="';
		c += b.goods_name;
		c += '" target="_blank"><img width="96" height="64" src="';
		c += $.__IMG + "/" + b.goods_thumb_1;
		c += '" /></a></div><div class="Right"><a href="';
		c += b.url;
		c += '" title="';
		c += b.goods_name;
		c += '" target="_blank">';
		c += b.goods_name.substring(0, 14);
		c += '</a><br /><span class="gray">销量：</span><span class="orange">';
		c += b.total_sold_count;
		c += '</span><br /><span class="gray">' + b.price_tag + '：</span><span class="red yen">&yen;';
		c += b.effect_price;
		c += "</span></div></div>";
	}
	f.html(c);
	g.removeClass("none");
};
$(document).ready(CategoryInit);
/*GH:2013-11-25 15:42:26*/
