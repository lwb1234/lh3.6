/*0816-leihao*/var mllComment={};mllComment.show=function(a,b){M.showLoginBox(function(){mllComment.parm={cType:a,goodsId:b};mllComment.insertCss();mllComment.createMask();if(mllComment.parm.cType==2){mllComment.getGoodsList();}else{mllComment.createElement(650,mllComment.createUI());}if(M.getCookie("meilele_login")=="1"&&M.getCookie("ECS[username]")){M.$("#JS_comment_username").innerHTML=M.getCookie("ECS[username]");M.$("#JS_comment_email").value=M.getCookie("ECS[email]");}});};mllComment.hide=function(b,c){var d=M.$("#MASKLAYER"),a=M.$("#FIXEDLAYER");document.body.removeChild(d);document.body.removeChild(a);if(b=="reload"){location.reload();}if(typeof c=="function"){c();}};mllComment.insertCss=function(){var a=document.createElement("link");a.type="text/css";a.rel="stylesheet";a.href="http://image.meilele.com/css/mll_comment.min.css";document.getElementsByTagName("HEAD")[0].appendChild(a);};mllComment.createMask=function(){var i=M.$("#MASKLAYER"),c=M.$("#FIXEDLAYER");if(i){document.body.removeChild(i);}if(c){document.body.removeChild(c);}var d=document.createDocumentFragment();var b=document.createElement("div"),e=(document.body.scrollHeight>=window.screen.availHeight)?document.body.scrollHeight:window.screen.availHeight;b.id="MASKLAYER";b.className="maskLayer";b.style.cssText="height:"+e+"px";var f=document.createElement("div");f.id="FIXEDLAYER";f.className="fixedLayer";var a=document.createElement("div");a.id="CONTAINER";a.className="CONTAINER";a.style.cssText="width:240px;";a.innerHTML='<div class="loading"><img src="http://image.meilele.com/themes/paipai/images/loading.gif" width="16" height="16" /> 正在加载，请稍候...</div>';d.appendChild(b);d.appendChild(f);f.appendChild(a);document.body.appendChild(d);};mllComment.createElement=function(a,c){var b=M.$("#CONTAINER");b.style.cssText="width:"+a+"px";b.innerHTML=c;};mllComment.createUI=function(){var f=[],h=(mllComment.parm.cType==0)?"评价":"咨询",c=new Date(),e=c.getFullYear()+"-"+parseInt(c.getMonth()+1)+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds();f.push('<h2 class="header"><span>美乐乐家具网会员'+h+'</span><a href="javascript:;" onclick="mllComment.hide();" class="close" title="关闭"></a></h2>');f.push('<div class="body">');f.push('<div class="box">');f.push('<div class="userInfo"><strong class="Left">用户名：</strong><span id="JS_comment_username" class="Left">匿名用户</span><span class="email">电子邮件地址：<input type="text" id="JS_comment_email" name="email" /></span><span class="Right fr">'+e+"</span></div>");if(mllComment.parm.cType==0){var b=[];for(var d=0;d<5;d++){b.push('<a onmouseover="mllComment.hightLightStar('+d+')" href="javascript:;"></a>');}f.push('<div class="commentLevel"><span>评价等级：</span><span id="JS_level" class="commentStar">'+b.join("")+"</span></div>");f.push('<div class="hongBao">写购物评价，赚取现金红包！<br />凡购买客户参与当前购买产品评论，均可得<span class="red">20元红包</span>，评论前十名更有<span class="red">50元红包</span>相送！</div>');}f.push('<h4 class="txtTilte">'+h+"详情</h4>");f.push('<textarea class="commentTextarea" id="JS_comment_content" name="content"></textarea>');f.push('<div class="buttonBox"><span id="submit_status"></span><a onclick="M.$(\'#JS_comment_content\').value=\'\';" href="javascript:;">重置表单</a><a onclick="mllComment.submit();" href="javascript:;">提交'+h+"</a></div>");f.push("</div>");f.push("</div>");return f.join("");};mllComment.commentSuccess=function(j,b,d,h){var c=[],e='<a class="lred" href="'+location.href+'" target="_blank" title="">'+j+"</a>",i=mllComment.createShare(),a=location.href+"#comment",f;if(d){f="恭喜你获得"+d+'，请于"<a class="lred" href="/user/?act=order_list" target="_blank" title="个人中心">个人中心</a>"查收，';}else{f="";}c.push('<h2 class="successTitle"><a href="javascript:;" onclick="mllComment.hide(\'reload\');" class="c-close"></a></h2>');c.push('<div class="successBody clearfix">');c.push('<div class="successList clearfix">');c.push("<h4>1、评价成功</h4>");c.push('<p class="prizeInfo">你已成功评价了"'+e+'"，你是第'+b+"位评价的用户，"+f+"感谢你对美乐乐的支持</p>");c.push("</div>");c.push('<div class="successList clearfix">');c.push("<h4>2、待分享的内容</h4>");c.push('<div class="shareContent">');c.push('<div class="productBox"><a href="'+location.href+'" target="_blank" title="goodsName"><img src="http://image.meilele.com/'+h+'" alt="'+j+'" /></a></div>');c.push('<div class="listRight">');c.push('<p>我在美乐乐家具网买的"'+e+'"，大家都来看看，~~支持下吧~~</p>');c.push('<div class="productShare"><span class="fShare">分享到：</span><span>'+i+"</span></div>");c.push("</div>");c.push("</div>");c.push("</div>");c.push('<h4 class="lookMyNotes"><a href="javascript:;" onclick="winDialog.gotoPage('+mllComment.parm.goodsId+');" title="查看我的评价">查看我的评价</a></h4>');c.push('<p class="fastLink"><a href="/user/?act=order_list" target="_blank" title="我的美乐乐">【我的美乐乐】</a>&ensp;<a href="/" target="_blank" title="美乐乐首页">【美乐乐首页】</a>&ensp;<a href="javascript:;" title="关闭" onclick="mllComment.hide(\'reload\');">【关闭此窗口】</a></p>');c.push("</div>");c.push('<div class="successFooter"></div>');return c.join("");};mllComment.createAttention=function(){var a=[];a.push('<h2 class="header">提示信息<a href="javascript:;" onclick="mllComment.hide(\'reload\');" class="close"></a></h2>');a.push('<div class="body">');a.push('<div class="infoBox">');a.push('<div class="infoTxt">您的问题已提交成功，感谢您的支持。</div>');a.push('<p class="btnBox"><a href="javascript:;" onclick="mllComment.hide(\'reload\');"></a></p>');a.push("</div>");a.push("</div>");return a.join("");};mllComment.createShare=function(e,d){var c=[],b,f,a={qzone:["0px -64px","QQ空间"],tsina:["0px -96px","新浪微博"],tqq:["0px -144px","腾讯微博"],renren:["0 -160px","人人网"]};b=(e)?e:encodeURIComponent(location.href);f=(d)?d:encodeURIComponent(document.title);for(ico in a){c.push('<a href="http://www.jiathis.com/send/?webid='+ico+"&url="+b+"&title="+f+'" title="分享到'+a[ico][1]+'" target="_blank" style="background-position:'+a[ico][0]+';"></a>');}return c.join("");};mllComment.hightLightStar=function(c){var d=M.$("#JS_level");var b=d.getElementsByTagName("a");d.className="";d.className="commentStar L"+(c+1);};mllComment.getLevel=function(){if(mllComment.parm.cType==0){var a=M.$("#JS_level").className;a=a.replace("commentStar ","");k=(a=="commentStar")?0:a.replace("L","");}else{k="";}return k;};mllComment.submit=function(){var c={},e=mllComment.getLevel();c.username=M.$("#JS_comment_username").innerHTML;c.email=M.$("#JS_comment_email").value;c.content=M.$("#JS_comment_content").value;c.type=mllComment.parm.cType;c.id=mllComment.parm.goodsId;c.version="new";var d=c.email.search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/);if(d==-1){M.$("#submit_status").innerHTML="请填写有效的邮箱地址！";return;}if(mllComment.parm.cType==0){if(e){c.rank=e;}else{M.$("#submit_status").innerHTML="请选择评分等级！";return;}}else{c.rank=0;}if(c.content.length<10){M.$("#submit_status").innerHTML="请输入不少于10个字符！";return;}M.$("#submit_status").innerHTML='<img src="http://image.meilele.com/themes/paipai/images/loading.gif" width="16" height="16" /> 正在提交，请稍候...';var a=[];c.content=c.content.replace(/\"/g,"'");for(var b in c){if(typeof c[b]=="function"){continue;}a.push('"'+b+'":"'+c[b]+'"');}M.ajax({url:"/ajax_comment/",data:"cmt={"+a.join(",")+"}",type:"POST",dataType:"json",success:function(f){if(f.error==1){alert(f.message);mllComment.hide();}if(f.error==0&&mllComment.parm.cType==0){mllComment.hide();mllComment.createMask();mllComment.createElement(540,mllComment.commentSuccess(f.goods_name,f.new_comment_id,f.redWallet,f.goods_img));}if(f.error==0&&mllComment.parm.cType==1){mllComment.hide();mllComment.createMask();mllComment.createElement(390,mllComment.createAttention());}},error:function(){alert("系统错误，请稍后重试");mllComment.hide();}});};mllComment.getGoodsList=function(){var a=mllComment.parm.goodsId;if(!a){return;}M.ajax({url:"/ajax_ajax.html?act=getGoodsByOrderSn&order_sn="+a,dataType:"json",success:function(d){var c=[],b=[];for(g in d){b.push('<li><div><a href="'+d[g].goods_url+'" target="_blank" title="'+d[g].goods_name+'"><img src="http://image.meilele.com/'+d[g].img+'" alt="'+d[g].goods_name+'" /></a></div><p><a href="'+d[g].goods_url+'" target="_blank" title="'+d[g].goods_name+'">'+d[g].goods_name+'</a></p><p><a onclick="mllComment.show(0,'+d[g].goods_id+')" class="lred" href="javascript:;" title="我要评价">我要评价</a></li>');}c.push('<h2 class="header">美乐乐家具网会员评价<a href="javascript:;" onclick="mllComment.hide();" class="close"></a></h2>');c.push('<div class="body">');c.push('<div class="goodsList"><ul>'+b.join("")+"</ul></div>");c.push("</div>");mllComment.createElement(240,c.join(""),"");},error:function(){alert("请求失败，请稍候重试");mllComment.hide();}});};