$.sendSms=function(b,a){new $.sendSms.prototype.init(b,a);};$.sendSms.prototype={constructor:$.sendSms,bg:"http://image.meilele.com/images/zhuanti/upload/a_1374111909.gif",styleInserted:false,title:{exprAddress:"免费发送体验馆地址到手机",get_out_goods:"免费发送特卖信息到手机",getPrize:"体验馆抽奖"},init:function(b,a){if($._currentSendSmsBox){$._currentSendSmsBox.remove();
}this.setting=$.extend({type:"exprAddress",phoneNumber:false,autoSend:false,autoClose:true,defaultCityId:parseInt($.cookie("region_id"))},a);if(b==false&&this.setting.exprInfo&&this.setting.exprInfo.exprList&&this.setting.exprInfo.exprList.length==1){b=this.setting.exprInfo.exprList[0].exprId;
delete this.setting.exprInfo;}this.exprId=b;this.setStyleRule();this.dom=this.show();$._currentSendSmsBox=this;if(!this.exprId&&this.setting.exprInfo){this.insertExprSelect();
}else{if(!this.exprId&&!this.setting.exprInfo){this.insertCitySelect();}}this.msgBox=$("#_JS_sndSms_msg_box_");this.inpt=$("#_JS_sndSms_input_");this.btn=$("#_JS_sndSms_btn_");
this.captcha=$("#_JS_sndSms_captcha_");this.captchaImg=$("#_JS_sndSms_captchaImg_");if(this.setting.phoneNumber&&this.setting.autoSend){this.send();}this.getCaptcha(this.setting.captchaSrc);
this.captcha_flag=false;this.captcha_icon=$("#_JS_sendSms_captcha_icon");$.checkCaptcha(this.captcha,{success:function(){var c=$._currentSendSmsBox.captcha_icon;
c.addClass("sms_captcha_success");c.removeClass("sms_captcha_error");$._currentSendSmsBox.captcha_flag=true;},error:function(){var c=$._currentSendSmsBox.captcha_icon;
c.removeClass("sms_captcha_success");c.addClass("sms_captcha_error");$._currentSendSmsBox.captcha_flag=false;}});},setStyleRule:function(){if(!this.styleInserted){var a=[];
var b;a.push(".sms_box {width:420px;padding-bottom:20px;border:5px solid #aaa;border-color:rgba(170,170,170,.8);background:#fff;margin:0px auto;overflow:hidden;}");
a.push(".sms_content {padding-top:19px;}");a.push(".sms_input {width:205px;height:28px;border:1px solid #c1c1c1;padding:0;margin:0;color:#555;padding-left:5px;line-height:28px;}");
a.push(".sms_captcha {width:34px;height:28px;border:1px solid #c7c7c7;padding:0;margin:0;vertical-align:top;color:#555;padding-left:5px;line-height:28px;}");
a.push(".sms_content label {height:28px; line-height: 28px;width:150px;text-align:right;display:inline-block;vertical-align:top;}");if(this.exprId){a.push(".sms_content label{width:120px;}");
}a.push(".sms_submit {height:31px;background:#d00 url("+this.bg+") 0px  0px;width:81px;color:#fff;text-align:center;border:none;margin:0;padding:0;font-weight:bold;}");
a.push(".sms_submit:hover {background-position: 0 -31px;}");a.push("._selectbox{display:inline-block;padding-top:4px;border:1px solid #ddd;height:24px;margin-bottom:8px;padding-right:5px;*border:none;}");
a.push("._sndsms_select{border:none;margin:0;margin-bottom:10px;width:207px;}");a.push("#_JS_sndSms_city_list_,#_JS_sndSms_province_list_{width:95px;}");
a.push("._check_icon{display:inline-block;height:16px;width:15px;margin-top:9px;}");a.push(".sms_captcha_success{background:url("+$.__IMG+"/images/check_icon8.png) 0 -8px no-repeat}");
a.push(".sms_captcha_error{background:url("+$.__IMG+"/images/check_icon8.png) 0 -30px no-repeat}");$.insertStyle(a.join(""));this.styleInserted=true;}},show:function(){var a="请输入您的手机号";
var b="";b+='<div class="sms_box" style="">';b+='<div class="clearfix" style="height:40px;line-height:40px;border-bottom:1px solid #dedede;padding-left:32px;color:#333;background:#f1f1f1 url('+this.bg+') -56px -62px no-repeat;"><div class="Left" style="font-size:16px;font-family:微软雅黑;">'+(this.title[this.setting.type]?this.title[this.setting.type]:"免费发送到手机")+'</div><div class="Right" style="padding-right:10px;"><a style="font-size:18px;color:#909090;font-weight:bold;" href="javascript:;" onclick="$.closeLightBox(\'{=id}\');">&times;</a></div></div>';
b+='<div class="sms_content" style="">';b+='<div id="_JS_sndSms_city_select_"></div>';b+='<div id="_JS_sndSms_expr_select_"></div>';b+='<div><label for="_JS_sndSms_input_">手机号：</label><input class="sms_input" value="'+(this.setting.phoneNumber||a)+'" onfocus="if(this.value==\''+a+'\')this.value=\'\'" onkeypress="$._currentSendSmsBox.keyPress(event);" id="_JS_sndSms_input_" name="_JS_sndSms_input_" /></div>';
b+='<div style="margin-top:10px;"><label for="_JS_sndSms_captcha_">验证码：</label><input class="sms_captcha" value="'+(this.setting.captcha||"")+'" onfocus="$._currentSendSmsBox.msgBox.html(\'\');if(this.value==\'验证码\')this.value=\'\'" id="_JS_sndSms_captcha_" name="_JS_sndSms_captcha_" onkeypress="$._currentSendSmsBox.keyPress(event);" ><img src="http://image.meilele.com/themes/paipai/images/blank.gif" style="width:75px;margin-right:5px;height:30px;vertical-align:top;margin-left:8px;cursor:pointer" title="换一张" onclick="$._currentSendSmsBox.getCaptcha();$._currentSendSmsBox._reset_captcha();return false;" id="_JS_sndSms_captchaImg_" /><span class="_check_icon" id="_JS_sendSms_captcha_icon"></span></div>';
b+='<div style="margin-top:10px;"><label></label><input id="_JS_sndSms_btn_" type="button" style="" class="pointer sms_submit" onclick="$._currentSendSmsBox.send();" value=" " /></div>';
b+='<div style="margin-top:20px;text-align:center"><a href="/topic/meilelegw.html" target="_blank">关注美乐乐微信公众号，可获取详细导航路线</a></div>';b+='<div style="color:#454545;padding-top:10px;text-align:center" id="_JS_sndSms_msg_box_"></div>';
b+="</div>";b+="</div>";b+="";return $.lightBox(b,{},true);},insertExprSelect:function(){str="";str+='<div><label><span class="red">'+this.setting.exprInfo.cityName+'</span>现有<span class="red">'+this.setting.exprInfo.exprList.length+'</span>家体验馆：</label><span class="_selectbox"><select class="_sndsms_select" onchange="$._currentSendSmsBox.exprId=this.value;">';
str+='<option value="0">请选择附近体验馆</option>';for(var a=0;a<this.setting.exprInfo.exprList.length;a++){var b="";if(this.setting.exprInfo.exprList.length==1||this.setting.defaultExprId==this.setting.exprInfo.exprList[a].exprId){b=' selected="selected"';
this.exprId=this.setting.exprInfo.exprList[a].exprId;}str+="<option"+b+' value="'+this.setting.exprInfo.exprList[a].exprId+'">'+this.setting.exprInfo.exprList[a].exprName+"</option>";
}str+="</select></span></div>";$("#_JS_sndSms_expr_select_").html(str);},insertCitySelect:function(){var e=this;var b=this.cityInfo;if(b){var d="";d+="<div>";
d+="<label>请选择您所在城市：</label>";d+='<span class="_selectbox"><select class="_sndsms_select" id="_JS_sndSms_province_list_" onchange="$._currentSendSmsBox.provinceSelected(this.value);">';
d+='<option value="0">请选择省</option>';for(var a in b){var f="";if(this.setting.defaultCityId&&b[a]&&b[a].cityList&&b[a].cityList[this.setting.defaultCityId]){f=' selected="selected"';
var c=a;}d+='<option value="'+a+'"'+f+">"+b[a].provinceName+"</option>";}d+="</select></span>";d+='<span class="_selectbox" style="margin-left:12px;"><select class="_sndsms_select" id="_JS_sndSms_city_list_" onchange="$._currentSendSmsBox.citySelected(this.value,this.options[this.selectedIndex].innerHTML);"><option value="0">请选择市</option></select></span>';
d+="</div>";$("#_JS_sndSms_city_select_").html(d);if(c){this.provinceSelected(c);}}else{this.lock=true;$("#_JS_sndSms_city_select_").html('<div style="padding-bottom:20px;text-align:center;color:#999">正在获取数据，请稍候...</div>');
$.ajax({url:"/ajax_ajax.html?act=getSmsExprList",dataType:"json",cache:true,success:function(g){e.cityInfo=g;e.insertCitySelect();e.lock=false;},error:function(){$.alert2("发生网络错误，请稍候再试。");
e.remove();}});}},provinceSelected:function(e){if(!parseInt(e)){return;}var b='<option value="0">请选择市</option>';for(var a in this.cityInfo[e].cityList){var d="";
if(this.setting.defaultCityId&&a==this.setting.defaultCityId){d=' selected="selected"';var c=[a,this.cityInfo[e].cityList[a].cityName];}b+='<option value="'+a+'"'+d+">"+this.cityInfo[e].cityList[a].cityName+"</option>";
}$("#_JS_sndSms_city_list_").html(b);this.selectedProvinceId=e;if(c){this.citySelected.apply(this,c);}},citySelected:function(d,b){if(!parseInt(d)){return;
}var c=[];for(var a in this.cityInfo[this.selectedProvinceId].cityList[d].exprList){c.push({exprName:this.cityInfo[this.selectedProvinceId].cityList[d].exprList[a],exprId:a});
}this.setting.exprInfo={cityName:b,exprList:c};this.insertExprSelect();this.selectedCityId=d;},getCaptcha:function(a){if(a){$._currentSendSmsBox.captchaImg.attr("src",a);
}else{$.ajax({url:"/user/?act=get_captcha",cache:false,success:function(b){$._currentSendSmsBox.captchaImg.attr("src",b);}});}},remove:function(){if($._currentSendSmsBox&&$._currentSendSmsBox.dom){$($._currentSendSmsBox.dom).remove();
delete ($._currentSendSmsBox);}},send:function(){if(this.lock){return;}var c=parseInt($._currentSendSmsBox.inpt.val().replace(/\D/g,""),10);var b=$._currentSendSmsBox.captcha.val();
$._currentSendSmsBox.inpt.val(c||"");if(!parseInt(this.exprId)){$._currentSendSmsBox.msg("请选择离您最近的体验馆。");return;}if(!c){$._currentSendSmsBox.msg("请输入正确手机号码。");
return;}if(!b||b=="验证码"||!$._currentSendSmsBox.captcha_flag){$._currentSendSmsBox.captcha_icon.removeClass("sms_captcha_success");$._currentSendSmsBox.captcha_icon.addClass("sms_captcha_error");
$._currentSendSmsBox.msgBox.html(" ");return;}$._currentSendSmsBox.msg("发送中...");$._currentSendSmsBox.btn.disabled=true;var d={};for(var a in $._currentSendSmsBox.setting){if(a!="captcha"&&a!=="captchaSrc"&&typeof $._currentSendSmsBox.setting[a]!="object"&&typeof $._currentSendSmsBox.setting[a]!="function"){d[a]=$._currentSendSmsBox.setting[a];
}}$.ajax({url:"/ajax_ajax.html?act=send_expr_message&expr_id="+$._currentSendSmsBox.exprId+"&mobile="+c+"&captcha="+b+"&url="+encodeURIComponent(location.href),data:d,type:"get",dataType:"json",success:function(e){$._currentSendSmsBox.getCaptcha();
$._currentSendSmsBox._reset_captcha();if(e.error=="0"){var f=$.cookie("MLLFROM");window._gaq=window._gaq||[];_gaq.push(["_trackEvent","sms",$._currentSendSmsBox.setting.type,(($.cookie("MLLFROM")||$.cookie("MLLSEO"))+"_undefined").split("_")[0]+($._currentSendSmsBox.setting.click?("_"+$._currentSendSmsBox.setting.click):"")]);
if($._currentSendSmsBox.setting.autoClose){e.msg+="<br />本窗口将在2秒后自动关闭。";setTimeout($._currentSendSmsBox.remove,4000);}$._currentSendSmsBox.msg(e.msg,true);
if($._currentSendSmsBox.setting.success){$._currentSendSmsBox.setting.success(e);}}else{$._currentSendSmsBox.msg(e.msg);$._currentSendSmsBox.btn.disabled=false;
}},error:function(){$._currentSendSmsBox.getCaptcha();$._currentSendSmsBox._reset_captcha();$._currentSendSmsBox.msg("发送失败");$._currentSendSmsBox.btn.disabled=false;
}});},msg:function(b,c){var a=c?"-42":"-27";b='<span style="display:inline-block;vertical-align:middle;width:14px;height:14px;background:url('+this.bg+") "+a+'px -65px;margin-right:6px;"></span><span style="vertical-align:middle;color:#f24443;">'+b+"</span>";
$._currentSendSmsBox.msgBox.html(b);},keyPress:function(a){a=a||window.event;if(a.keyCode==13){$._currentSendSmsBox.send();}},_reset_captcha:function(){$._currentSendSmsBox.captcha.val("");
$._currentSendSmsBox.captcha_flag=false;$._currentSendSmsBox.captcha_icon[0].className="_check_icon";}};$.sendSms.prototype.init.prototype=$.sendSms.prototype;

/*GH:2013-11-19 14:33:26*/