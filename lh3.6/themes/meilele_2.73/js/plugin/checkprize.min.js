$.checkPrize=function(){new $.checkPrize.prototype.init();};$.checkPrize.prototype={bg:"http://image.meilele.com/images/zhuanti/upload/a_1374111909.gif",title:"礼品查询",init:function(a){this.setting=$.extend({Send_pg:"http://image.meilele.com/images/default/send.png",flag:0,pNumber:0,},a);
this.setStyleRule();this.dom=this.show();$._currentCheckPrizeBox=this;this.captchaImg=$("#_JS_prz_captchaImg_");this.btn=$("#_JS_prz_btn_").get(0);this.btn2=$("#_JS_prz_btn2_").get(0);
this.btn3=$("#_JS_prz_btn3_").get(0);this.btn5=$("#_JS_prz_btn5_").get(0);this.btn6=$("#_JS_prz_btn6_").get(0);this.tishiA=$("#_prz_tishiA").get(0);this.tishiB=$("#_prz_tishiB").get(0);
this.tishiC=$("#_prz_tishiC").get(0);this.tishiD=$("#_prz_tishiD").get(0);this.getCaptcha();$.checkCaptcha($("#_JS_prz_captcha_"),{success:function(){var b=$("#_JS_sndPrize_captcha_icon");
b.addClass("sms_captcha_success");b.removeClass("sms_captcha_error");},error:function(){var b=$("#_JS_sndPrize_captcha_icon");b.removeClass("sms_captcha_success");
b.addClass("sms_captcha_error");}});},setStyleRule:function(){if(!this.styleInserted){var a=[];var b;a.push(".prz_box {width:500px;padding-bottom:20px;border:5px solid #aaa;border-color:rgba(170,170,170,.8);background:#fff;margin:0px auto;overflow:hidden;}");
a.push(".prz_content {padding:19px 0 0 85px;}");a.push(".prz_input {width:200px;height:28px;border:1px solid #c7c7c7;padding:0;margin:0;vertical-align:top;color:#555;padding-left:15px;line-height:28px;}");
a.push(".prz_captcha {width:60px;}");a.push(".prz_yuanjiao {background:#FAFAFA;font-weight:bold;text-align:center;width:40px;font-family:Arial;border:2px solid #ccc;border-radius:5px;padding:6px 6px;display:inline-block;margin-left:10px;}");
a.push(".prz_cellcaptcha {width:120px;}");a.push(".prz_yuanjiao2 {width:55px;color:#888888}");a.push(".prz_sure {margin-left:10px;width:100px;height:20px;padding-top:8px;color:#0099CC;display:none;}");
a.push(".prz_yuanjiao3 {width:100px;color:#999999;display:none;}");a.push(".prz_yuanjiao5 {width:130px;color:#999999;display:none;}");a.push(".prz_select {margin-left:165px;margin-top:5px;background:#DD0031;color:white;border:1px solid #DD0031;}");
a.push(".prz_content label {color:#333;display:inline-block;width:80px;height:28px;text-align:right;padding-top:6px;}");a.push(".prz_gundong {display:none;margin:10px 25px 0px 25px;}");
a.push("._check_icon{display:inline-block;height:16px;width:15px;margin-top:9px;}");a.push(".sms_captcha_success{background:url("+$.__IMG+"/images/check_icon8.png) 0 -8px no-repeat}");
a.push(".sms_captcha_error{background:url("+$.__IMG+"/images/check_icon8.png) 0 -30px no-repeat}");$.insertStyle(a.join(""));this.styleInserted=true;}},show:function(){var a="请输入您的手机号";
var b="";b+='<div class="prz_box">';b+='<div style="height:40px;line-height:40px;border-bottom:1px solid #dedede;padding-left:32px;color:#333;background:#f1f1f1 url('+this.bg+') -56px -62px no-repeat;"><div class="Left" style="font-size:16px;font-family:微软雅黑;">'+this.title+'</div><div class="Right" style="padding-right:10px;"><a style="font-size:18px;color:#909090;font-weight:bold;" href="javascript:;" onclick="$.closeLightBox(\'{=id}\');">&times;</a></div></div>';
b+='<div class="prz_content" style="">';b+='<div><label>手机号：</label><input id="_JS_prz_input_" class="prz_input" value="'+a+'" onblur="$._currentCheckPrizeBox.hiddenPhone()" value="'+a+'" onfocus="$._currentCheckPrizeBox.value_null()"/></div>';
b+='<div><span id="_prz_tishiA" style="margin-left:80px;display:none;"></span></div>';b+='<div id="_prz_d_captcha" style="margin-top:10px;"><label>验证码：</label><input id="_JS_prz_captcha_" class="prz_input prz_captcha" value="" onfocus="if(this.value==\'验证码\')this.value=\'\'"><img style="width:75px;margin-right:5px;height:30px;vertical-align:top;margin-left:8px;cursor:pointer" title="换一张" onclick="$._currentCheckPrizeBox.getCaptcha()" id="_JS_prz_captchaImg_"/><span class="_check_icon" id="_JS_sndPrize_captcha_icon"></span></div>';
b+='<div><span id="_prz_tishiD" style="color:#ee0404;margin-left:80px;display:none;"></span></div>';b+='<div id="_prz_d_cellcaptcha" style="margin-top:10px;"><label>手机校验码：</label><input id="_JS_prz_cellcaptcha_" class="prz_input prz_cellcaptcha" value="" onfocus="if(this.value==\'手机验证码\')this.value=\'\'" ><div id="_JS_prz_btn2_" onclick="$._currentCheckPrizeBox.getCellCaptcha();" class="pointer prz_yuanjiao prz_yuanjiao2">免费获取</div><div id="_JS_prz_btn3_" onclick="$._currentCheckPrizeBox.getNewCaptcha();" class="pointer prz_sure">没有收到校验码？</div><div id="_JS_prz_btn5_" class="prz_yuanjiao prz_yuanjiao5">(0秒后) 重新获取短信</div><div id="_JS_prz_btn6_" onclick="$._currentCheckPrizeBox.getCaptchaAgin();" class="pointer prz_yuanjiao prz_yuanjiao3">重发短信校验码</div></div>';
b+="</div>";b+='<div id="_prz_msgall" style="margin-left:165px;display:none;"><span style="display:inline-block;vertical-align:middle;width:14px;height:14px;background:url('+this.bg+') -27px -65px;margin-right:6px;"></span><span id="_tishiE" style="vertical-align:middle;color:#f24443;"></span></div>';
b+='<div id="_prz_gundong" class="prz_gundong" ><span id="_prz_tishiB" style="display:none;color:#ee0404;word-spacing:2px;line-height:25px;"></span></div>';
b+='<div></div><div id="_JS_prz_btn_" onclick="$._currentCheckPrizeBox.send();" class="prz_select pointer prz_yuanjiao">查询</div>';b+='<div style="margin:10px 10px 0px 60px;"><span id="_prz_tishiC" style="display:none;color:#ee0404;"></span></div>';
b+="</div>";b+="";return $.lightBox(b,{},true);},getCaptcha:function(a){if(a){$._currentCheckPrizeBox.captchaImg.attr("src",a);}else{$.ajax({url:"/user/?act=get_captcha",cache:false,success:function(b){$._currentCheckPrizeBox.captchaImg.attr("src",b);
}});}},value_null:function(a){if(this.btn5.innerHTML=="(0秒后) 重新获取短信"||this.btn5.innerHTML=="(-1秒后) 重新获取短信"){$("#_JS_prz_input_").get(0).value="";this.setting.pNumber=0;
this.setting.flag=0;this.btn2.style.display="inline-block";this.btn3.style.display="none";this.btn5.style.display="none";this.btn6.style.display="none";
this.tishiA.style.display="none";this.tishiD.style.display="none";$("#_prz_msgall").get(0).style.display="none";$("#_JS_prz_cellcaptcha_").get(0).style.border="1px solid #c7c7c7";
$("#_JS_prz_cellcaptcha_").get(0).style.color=" #555";}if(this.tishiB.style.display=="inline-block"){$("#_JS_prz_captcha_").get(0).value="";$("#_JS_prz_cellcaptcha_").get(0).value="";
$._currentCheckPrizeBox.getCaptcha();$("#_prz_d_captcha").get(0).style.display="inline-block";$("#_prz_d_cellcaptcha").get(0).style.display="inline-block";
this.tishiB.style.display="none";this.btn.style.display="inline-block";$("#_prz_gundong").get(0).style.display="none";}},hiddenPhone:function(){var a=$("#_JS_prz_input_").get(0).value;
if(/^[1][358][0-9]{9}$/.test(a)){this.setting.pNumber=a;}if(/^[1][358][0-9]{9}$/.test(this.setting.pNumber)){this.tishiA.style.display="none";$("#_JS_prz_input_").get(0).value=this.setting.pNumber.substring(0,3)+"****"+this.setting.pNumber.substring(7,11);
this.setting.flag=1;}else{this.tishiA.innerHTML="您输入的手机号不正确。";this.tishiA.style.display="inline-block";this.tishiA.style.color="#f24443";}},getCellCaptcha:function(){if(this.setting.flag==1){var b=$("#_JS_prz_captcha_").get(0).value;
if(b.length!=4){this.tishiD.innerHTML="您输入的验证码不正确。";this.tishiD.style.display="inline-block";$._currentCheckPrizeBox.getCaptcha();}else{var a=this.setting.pNumber;
$.ajax({url:"/user/?act=check_captcha&captcha="+b+"&no_clear=1",type:"GET",dataType:"json",success:function(c){if(c.error==0){$("#_prz_tishiD").get(0).style.display="none";
$.ajax({url:"/interface.html?act=get_mobile_captcha&mobile="+a,type:"GET",dataType:"json",success:function(e){if(e.error==0){$("#_JS_prz_btn2_").get(0).style.display="none";
$("#_JS_prz_btn3_").get(0).style.display="inline-block";$("#_prz_tishiA").get(0).style.color="#999999";var d=$("#_JS_prz_input_").get(0).value;$("#_prz_tishiA").get(0).innerHTML="校验码已发送至手机"+d+",请勿泄露。";
$("#_prz_tishiA").get(0).style.display="inline-block";}}});}else{$("#_prz_tishiD").get(0).innerHTML="您输入的验证码不正确。";$("#_prz_tishiD").get(0).style.display="inline-block";
$._currentCheckPrizeBox.getCaptcha();$("#_JS_prz_btn2_").get(0).style.display="inline-block";}}});}}},getNewCaptcha:function(){$._currentCheckPrizeBox.getCaptcha();
this.btn3.style.display="none";this.tishiA.style.display="none";this.btn5.style.display="inline-block";var a=this.btn5,d=this.btn6;this.btn5.innerHTML="(60秒后) 重新获取短信";
var c=setInterval(function(){if(a.innerHTML.substring(2,3)!="秒"){a.innerHTML="("+(a.innerHTML.substring(1,3)-1)+"秒后) 重新获取短信";}else{a.innerHTML="("+(a.innerHTML.substring(1,2)-1)+"秒后) 重新获取短信";
}},1000,a);var b=setTimeout(function(){a.style.display="none";d=$("#_JS_prz_btn6_").get(0);d.style.display="inline-block";clearInterval(c);},61000,a,d);
},getCaptchaAgin:function(){this.btn6.style.display="none";$._currentCheckPrizeBox.getCellCaptcha();},send:function(){if($("#_prz_tishiA").get(0).innerHTML.substring(0,3)=="校验码"&&(this.btn3.style.display=="inline-block"||this.btn6.style.display=="inline-block")){var c=$("#_JS_prz_captcha_").get(0).value;
if(c.length!=4){this.tishiD.innerHTML="您输入的验证码不正确。";this.tishiD.style.display="inline-block";$._currentCheckPrizeBox.getCaptcha();}else{this.tishiD.style.display="none";
var b=$("#_JS_prz_cellcaptcha_").get(0).value;var a=$("#_JS_prz_cellcaptcha_").get(0);if(b.length!=6){a.style.border="1px solid #ff5243";a.style.color="#ff5243";
$("#_tishiE").get(0).innerHTML="校验码有误。";$("#_prz_msgall").get(0).style.display="inline-block";}else{a.style.border="1px solid #c7c7c7";a.style.color=" #555";
$("#_prz_msgall").get(0).style.display="none";var d=this.setting.Send_pg;var e=this.setting.pNumber;$.ajax({url:"/interface.html?act=get_expr_prize_info&mobile="+this.setting.pNumber+"&captcha="+b,type:"GET",dataType:"json",success:function(g){if(g.error==0){$("#_prz_d_captcha").get(0).style.display="none";
$("#_prz_d_cellcaptcha").get(0).style.display="none";$("#_JS_prz_btn_").get(0).style.display="none";$("#_prz_tishiA").get(0).style.display="none";$("#_prz_tishiC").get(0).style.display="none";
$("#_prz_tishiB").get(0).style.display="inline-block";$("#_prz_gundong").get(0).style.display="inline-block";if(g.msg.length==1){$("#_prz_gundong").get(0).style.height="90px";
$("#_prz_gundong").get(0).style.overflowY="hidden";$("#_prz_tishiB").get(0).innerHTML=g.msg[0].content+"<img onclick='$._currentCheckPrizeBox.sendMessageToCellphone("+e+","+g.msg[0].prize_id+");' class='pointer' style='margin:5px  60px;' src="+d+" />";
}else{$("#_prz_gundong").get(0).style.height="115px";$("#_prz_gundong").get(0).style.overflowY="scroll";$("#_prz_tishiB").get(0).innerHTML="获奖信息:</br>";
for(var f=0;f<g.msg.length;f++){$("#_prz_tishiB").get(0).innerHTML+=(f+1)+". &nbsp;"+g.msg[f].content+"<img onclick='$._currentCheckPrizeBox.sendMessageToCellphone("+e+","+g.msg[0].prize_id+");' class='pointer' style='margin:5px 0 5px 60px;' src="+d+" /></br>";
}}}else{if(g.msg=="信息不全"||g.msg=="手机校验码错误"){a.style.border="1px solid #ff5243";a.style.color="#ff5243";$("#_tishiE").get(0).innerHTML="校验码有误。";$("#_prz_msgall").get(0).style.display="inline-block";
}if(g.msg=="没有相关信息"){$("#_prz_tishiA").get(0).style.display="none";$("#_prz_tishiB").get(0).style.display="none";$("#_prz_tishiC").get(0).style.display="inline-block";
$("#_JS_prz_captcha_").get(0).value="";$("#_JS_prz_cellcaptcha_").get(0).value="";$("#_JS_prz_btn3_").get(0).style.display="none";$("#_JS_prz_btn5_").get(0).style.display="none";
$("#_JS_prz_btn6_").get(0).style.display="none";$("#_JS_prz_btn2_").get(0).style.display="inline-block";$("#_prz_tishiC").get(0).innerHTML="该手机没有相关抽奖数据或您的现金抵用券已过期。";
$("#_prz_d_captcha").hide();$("#_prz_d_cellcaptcha").hide();$("#_JS_prz_btn_").hide();}}}});}}}},sendMessageToCellphone:function(a,b){$.ajax({url:"/interface.html?act=prize_info_send&mobile="+a+"&prize_id="+b,type:"GET",dataType:"json",success:function(c){if(c.error==0){alert("中奖信息已发送至你的手机。");
$._currentCheckPrizeBox.value_null();}else{alert(c.msg);}}});}};$.checkPrize.prototype.init.prototype=$.checkPrize.prototype;
/*GH:2013-11-19 14:33:26*/